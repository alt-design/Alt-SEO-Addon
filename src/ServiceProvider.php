<?php

namespace AltDesign\AltSeo;

use AltDesign\AltSeo\Events\Seo;

// Facades
use Illuminate\Support\Facades\Event;
use Statamic\Facades\CP\Nav;
use Statamic\Facades\Permission;

// Providers
use Statamic\Providers\AddonServiceProvider;

/**
 * Class ServiceProvider
 *
 * @package  AltDesign\AltSeo
 * @author   Ben Harvey <ben@alt-design.net>, Natalie Higgins <natalie@alt-design.net>
 * @license  Copyright (C) Alt Design Limited - All Rights Reserved - licensed under the MIT license
 * @link     https://alt-design.net
 */
class ServiceProvider extends AddonServiceProvider
{
    /**
     * @var string - Sets the namespace of the addon
     */
    protected $viewNamespace = 'alt-seo';

    /**
     * @var string[] - Bring in the tags for use
     */
    protected $tags = [
        \AltDesign\AltSeo\Tags\AltSeo::class,
    ];

    /**
     * @var string[] - Register our routes (mainly for settings tbh).
     */
    protected $routes = [
        'cp' => __DIR__.'/../routes/cp.php',
    ];

    /**
     * Pull the option into the CP Nav.
     */
    public function addToNav()
    {
        Nav::extend(function ($nav) {
            $nav->content('Alt SEO')
                ->section('Tools')
                ->can('view alt-seo')
                ->route('alt-seo.index')
                ->icon('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 600 600"><defs><style>.cls-1{;fill-rule:evenodd;stroke-width:0px;}</style></defs><path class="cls-1" d="m331.82,101.38c4.19-1.13,8.2-5.6,12.08-9.01,2.77-2.44,6.19-4.77,9.2-7.42,7.09-6.25,13.24-11.81,23-17.5,5.83-3.4,13.18-7.49,19.55-4.77,14.32,16.82-17.85,24.31-20.7,37.11-10.76,6.87-19.49,15.61-29.34,23.33,22.22,2.41,41.5,4.72,61.54,10.06-.07,2.44-1.42,4.92-2.88,7.43-2.23.28-2.81-.95-5.18-.53-15.42,3.8-41.48.3-58.07,2.65,9.58,18.2,25.01,31.01,33.35,50.36,1.97,2.25,4.19,4.26,6.91,5.83-.39,2.47.9,3.41,1.14,5.3-1.54.35-2.11,1.6-2.87,2.65-5.73.87-7.57-1.85-11.5-2.65-15.75-14.81-26.62-34.13-41.98-49.3-3.97,7.4.49,23.15-5.75,29.69.49,2.37.81,4.9,2.3,6.37-4.34,12.78-4.09,29.02-6.9,43.99-2.65-.02-5.63.24-7.47-.53-6.65-23.77-.38-55.11-.58-80.04-6.05,2.91-9.82,7.9-14.37,12.19-1.1.99-1.05-.32-2.88,0-4.11,4.16-7.33,9.15-14.37,10.6-8.09,7.21-18.31,12.45-28.18,18.01.24-1.27-1.05-1.14-.57-2.64-1.45.79-.78,3.52-3.46,3.18-2.33-1.71-3.09-2.82-2.3-5.3.5-1.57,2.9-2.02,4.03-3.18,2.64-2.72,4.04-6.77,6.89-10.07,2.46-2.84,5.95-5.35,8.63-8.49,7.2-8.44,17.87-18.15,25.31-25.44-10.9-1.52-23.08-1.86-35.08-1.06-1.36-.33-2.67-.71-2.87-2.12-3.12,2.37-9.29,2.28-13.8,1.59-4.28-.66-8.17-3.83-11.51-3.72-4.74-6.14-16.28-12.98-10.35-23.85,5.65-.97,8.67,5.66,13.23,6.89,4.97,1.34,14.66.53,20.12.53,16.84,0,35.25-1.05,50.6-.53-6.02-7.7-13.19-14.64-20.12-22.26-3.79-4.17-8.42-8.01-12.08-12.2-1.14-1.31-1.13-3.26-2.3-4.77-3.01-3.86-7.69-7.09-10.93-11.13-4.87-6.08-8.8-12.74-9.77-20.67-.01-2.48,4.1-1.17,4.03-3.71,17.09,4.07,23.05,19.97,33.35,30.21,10.81,10.75,21.9,20.67,31.06,32.34,2.27-5.11,2.98-11.57,3.45-17.49,1.4-17.71,2.49-37.31,3.45-56.19.23-4.45-.57-9.41,1.15-12.72.42-.85,2.82.12,2.3-1.59,5.11.05,7.51,2.62,10.35,4.77-1.02,3.14,1.22,5.75,2.87,7.95.45,4.47-1.36,14.71,1.15,17.49-.17,17.67-1.38,35.47-2.88,50.36Z"/><path class="cls-1" d="m74.2,305.89c-7.55-8.8-22.25-18.14-29.26-29.35-2.35-3.75-2.86-8.84-1.71-13.76.52-.56,1.26-.97,2.5-1.05.46-6.02,6.09-8.6,9.99-12.33,3.79.04,7.68-.43,10.95.5.68.2,2.27,2.1,3.75,2.5,3.54.92,6.12,2.47,9.82,5.6,2.56,2.18,5.92,4.54,6.47,5.21,6.45,7.58,15.38,13.94,22.47,19.87,4.45-6.64,4.38-15.44,7.36-22.64,2.25-5.43,7.19-7.98,9.25-13.27,11.92-5.34,28.88-4.86,36.31,5.13-.21,13.26-5.52,23.11-6.91,35.58,2.04.55,5.42-.91,5.84,2.07,15.33-3.35,40.99-.69,43.23,20.56-14.34,5.88-29.91,10.55-45.54,16.26,6.06,9.47,14.33,15.59,21.54,23.32.59,1.59-.73,2.27.63,3.12,8.96,4.81,14.19,17.49,21.84,22.17,1.02,2.06.47,4.53,2.1,7.72,2,3.87,3.14,3.5,4.62,9.37.23.93,1.66,2.79,1.67,2.92.27,4.01-3.8,10.43-5.4,10.85-4.65,1.25-5.76-7-11.9-5.18-.38-2.89-3.64-5.34-7.52-4.99-17.42-11.38-34.2-23.72-49.93-37.65-3.89,4.53-4.41,12.24-6.01,18.57-3.17,7.08-5.32,14.83-8.61,21.82-5.85,2.38-14.2-.54-19.3-1.52-3.48-.67-8.79-1.64-12.11-3.52-6.68-3.79-12.54-8.84-8.89-17.19.46-1.08,2.03-1.53,2.7-2.72,1.08-1.9.61-4.6,1.34-6.78,1.76-5.18,5.47-10.48,4.04-14.91,2.03-.91,2.77-4.58,2.07-5.85-15.49,3.13-37.16,7.51-51.38,14.2-6.32-3.33-7.43-10.72-8.18-18.96,1-.54-.38-2.66,1.67-2.51-.09-1.9-2.1-.91-2.2-2.81,2.9-4.4,3.38-10.39,6.22-14.82,8.3-7.73,22.82-11.34,36.47-15.52Z"/><path class="cls-1" d="m317.16,384.16c5.25.08,11.09-.41,15.26.77,16.58,10.35,29.02,24.85,51.08,29.73,11.26,8.32,24.69,14.46,37.37,21.35,2.05-18.95,2.86-39.6,3.8-60.23.57-12.39-.57-25.77.77-35.08.48-3.31,2.49-5.9,4.58-8.38,5.07.33,14.6,2.98,19.06,6.85,5.69,4.97,5.99,13.96,10.68,19.83-.87,20.93-3.19,47.59-4.57,66.34,18.09-12.54,43.94-24.26,62.53-35.83,4.95-3.09,9.21-8.38,17.53-5.34,3.42,3.95,7.6,7.16,10.69,11.43.24,7.73,2.39,11.66-.77,17.54-26.45,16.77-52.52,33.91-79.3,50.33,18.14,13.65,42.05,25.53,51.08,45.75-3.28,20.11-21.37,4.2-25.92-4.57-14.49-6.35-26.1-15.58-41.94-20.59-2.83,28.81-8.87,57.94-13.72,86.93-2.59-4.37-.19,8.31-3.82,10.68-4.29.36-6.01,1.01-9.91.76-8.94-23.42-1.06-62.94-3.81-88.45-27.02,13.14-50.09,30.24-79.31,41.17-10.52-2.41-36.61-4.01-27.44-19.82.89-.89,2.7-.87,4.57-.77,1.17-1.61,2.75-2.84,3.81-4.57,1.23-.21,1.32.73,2.29.77,25.87-18.37,53.58-34.88,80.82-51.85-.14-.66.3-.73.76-.77-1.81.82-4.64-4.82-7.63-6.86-2.09-1.44-5.74-1.57-8.38-3.05-4.65-2.6-6.29-4.2-12.21-6.86-6.76-3.05-15.05-9.5-22.87-14.49-8.35-5.32-17.33-11.19-21.35-15.24-3.88-3.9-13.59-14.66-14.49-19.07-.65-3.16.52-5.54.77-8.38Z"/></svg>');
        });
    }

    /**
     * Register our permissions, so we can control who can see the settings.
     *
     * @return void
     */
    public function registerPermissions()
    {
        Permission::register('view alt-seo')
                  ->label('View Alt SEO Settings');
    }

    /**
     * Register our events.
     *
     * @return void
     */
    public function registerEvents()
    {
        Event::subscribe(Seo::class);
    }

    /**
     * Load our views.
     *
     * @return void
     */
    protected function loadViews()
    {
        $this->loadViewsFrom(__DIR__.'/resources/views', 'alt-seo');
    }

    /**
     * Statamic boot method.
     *
     * @return void
     */
    public function bootAddon()
    {
        $this->loadViews();
        $this->addToNav();
        $this->registerPermissions();
        $this->registerEvents();
    }
}


